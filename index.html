<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bit Animation</title>
    <script src="./libs/multibyte-stream.umd.js"></script>
    <script src="./bit/frame.js"></script>
    <script src="./bit/frame-editor.js"></script>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .frame {
        width: 200px;
        height: 200px;
        margin: 50px;
      }
    </style>
  </head>
  <body>
    <div class="frame">
      <bit-frame-editor width="10" height="10" index="0" src=""></bit-frame-editor>
    </div>
  </body>
  <script>
    const FRAMES = [];

    const generateEmptyFrame = (width, height) => {
      const row = new Array(width);
      row.fill(0);

      return new Array(height)
        .fill(null)
        .map((_, index) => (index ? [...row] : row));
    };

    const insertNewFrameAt = (frames, index, width, height) => {
      const frame = generateEmptyFrame(width, height);

      frames.splice(index, 0, frame);
    };

    const insertNewFrame = (frames, width, height) =>
      insertNewFrameAt(frames, frames.length - 1, width, height);

    const copyFrameAt = (frames, index) => frames.map((row) => [...row]);

    (async () => {
      const { BitRenderer } = await import('./renderer.js');

      insertNewFrame(FRAMES, 10, 10);
      insertNewFrame(FRAMES, 10, 10);
      insertNewFrame(FRAMES, 10, 10);

      const renderer = new BitRenderer();

      await renderer.setSize(10, 10);

      document
        .querySelector('bit-frame-editor')
        .addEventListener(
          'bitSwitch',
          async ({ target, detail: { index, column, row } }) => {
            FRAMES[index][row][column] = Number(!FRAMES[index][row][column]);

            const source = renderer.drawToImageSrc(FRAMES[index]);

            target.src = source;
          }
        );
    })();
  </script>
</html>
